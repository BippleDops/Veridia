formulas:
  # Item image with rarity border
  ItemImage: |
    js:
    const rarityColors = {
      'Common': '#808080',
      'Uncommon': '#00FF00',
      'Rare': '#0080FF',
      'Very Rare': '#800080',
      'Legendary': '#FFA500',
      'Artifact': '#FF0000'
    };
    const rarity = target.rarity || 'Common';
    const color = rarityColors[rarity] || '#808080';
    const imagePath = target.image_path || `z_Assets/Placeholder Images/Item_${target.type || 'Generic'}.png`;
    return `<div style="border: 3px solid ${color}; padding: 2px; display: inline-block;">![[${imagePath}|100]]</div>`;
  
  # Item tooltip
  ItemTooltip: |
    js:
    const parts = [];
    if (target.type) parts.push(target.type);
    if (target.rarity) parts.push(target.rarity);
    if (target.attunement) parts.push("(Requires Attunement)");
    return parts.join(" • ");
  
  # Value display
  ValueDisplay: |
    js:
    if (target.cost) {
      return `💰 ${target.cost}`;
    }
    return "💰 Priceless";
  
  # Weight and encumbrance
  WeightDisplay: |
    js:
    if (target.weight) {
      return `⚖️ ${target.weight} lbs`;
    }
    return "⚖️ Weightless";
  
  # Magic properties summary
  MagicProperties: |
    js:
    const props = [];
    if (target.damage_bonus) props.push(`+${target.damage_bonus} damage`);
    if (target.ac_bonus) props.push(`+${target.ac_bonus} AC`);
    if (target.spell_list) props.push("Casts spells");
    if (target.charges) props.push(`${target.charges} charges`);
    return props.length > 0 ? props.join(", ") : "No magical properties";

views:
  - type: gallery
    name: Item Gallery
    filters:
      and:
        - folder.startsWith("3-Mechanics/Items")
    columns: 5
    properties:
      - formula.ItemImage
      - file.name
      - formula.ItemTooltip
      - formula.ValueDisplay
    
  - type: table
    name: Inventory Manager
    filters:
      and:
        - item_owner
    order:
      - item_owner
      - formula.ItemImage
      - file.name
      - type
      - rarity
      - formula.ValueDisplay
      - formula.WeightDisplay
      - formula.MagicProperties
    sort:
      - column: item_owner
        direction: ASC
      - column: rarity
        direction: DESC
    columnSize:
      item_owner: 120
      formula.ItemImage: 110
      file.name: 150
      type: 100
      rarity: 90
      formula.ValueDisplay: 80
      formula.WeightDisplay: 80
      formula.MagicProperties: 200
    
  - type: cards
    name: Magic Item Showcase
    filters:
      and:
        - rarity
        - not:
            - rarity.equals("Common")
    columns: 3
    properties:
      - formula.ItemImage
      - file.name
      - formula.ItemTooltip
      - formula.MagicProperties
      - formula.ValueDisplay 