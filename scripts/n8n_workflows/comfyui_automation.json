{
  "name": "ComfyUI TTRPG Asset Generation",
  "nodes": [
    {
      "parameters": {
        "path": "generate-assets",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "functionCode": "// Parse incoming request for batch generation\nconst { type, world, count, style } = items[0].json;\n\n// Asset type configurations\nconst assetConfigs = {\n  portrait: {\n    prompts: [\n      'fantasy character portrait, detailed face, dramatic lighting',\n      'heroic adventurer portrait, ornate armor, cinematic composition',\n      'mysterious mage portrait, glowing eyes, arcane symbols'\n    ],\n    dimensions: { width: 512, height: 512 }\n  },\n  creature: {\n    prompts: [\n      'fantastical beast, otherworldly creature, detailed anatomy',\n      'mythical monster, fearsome presence, dynamic pose',\n      'elemental being, magical essence, ethereal form'\n    ],\n    dimensions: { width: 512, height: 768 }\n  },\n  location: {\n    prompts: [\n      'fantasy landscape, epic vista, atmospheric perspective',\n      'ancient ruins, mysterious architecture, environmental storytelling',\n      'magical realm, otherworldly environment, cinematic wide shot'\n    ],\n    dimensions: { width: 768, height: 512 }\n  }\n};\n\n// World-specific modifiers\nconst worldModifiers = {\n  aquabyssos: 'underwater, deep sea, bioluminescent, coral structures',\n  aethermoor: 'floating islands, sky realm, crystalline, wind-swept',\n  void: 'eldritch, cosmic horror, reality distortion, impossible geometry'\n};\n\nconst config = assetConfigs[type] || assetConfigs.portrait;\nconst worldMod = worldModifiers[world] || '';\n\n// Generate prompt variations\nconst prompts = [];\nfor (let i = 0; i < (count || 5); i++) {\n  const basePrompt = config.prompts[i % config.prompts.length];\n  prompts.push({\n    name: `${type}_${world}_${Date.now()}_${i}`,\n    prompt: `${basePrompt}, ${worldMod}, ${style || 'highly detailed fantasy art'}`,\n    ...config.dimensions,\n    seed: -1\n  });\n}\n\nreturn [{\n  json: {\n    type,\n    world,\n    prompts,\n    priority: 5,\n    metadata: {\n      source: 'n8n',\n      workflow: 'comfyui_automation',\n      timestamp: new Date().toISOString()\n    }\n  }\n}];"
      },
      "id": "prepare-job",
      "name": "Prepare Generation Job",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "http://localhost:5679/queue/add",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "={{$json}}",
              "value": ""
            }
          ]
        },
        "options": {}
      },
      "id": "queue-job",
      "name": "Queue to Orchestrator",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [650, 300]
    },
    {
      "parameters": {
        "interval": 5,
        "unit": "minutes"
      },
      "id": "schedule-trigger",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 500]
    },
    {
      "parameters": {
        "functionCode": "// Auto-generate based on what's needed\nconst assetTypes = ['portrait', 'creature', 'location'];\nconst worlds = ['aquabyssos', 'aethermoor', 'void'];\n\n// Rotate through combinations\nconst hour = new Date().getHours();\nconst typeIndex = hour % assetTypes.length;\nconst worldIndex = Math.floor(hour / assetTypes.length) % worlds.length;\n\nreturn [{\n  json: {\n    type: assetTypes[typeIndex],\n    world: worlds[worldIndex],\n    count: 3,\n    style: 'detailed fantasy art, professional quality'\n  }\n}];"
      },
      "id": "auto-select",
      "name": "Auto-select Assets",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 500]
    },
    {
      "parameters": {
        "url": "http://localhost:5679/stats",
        "method": "GET",
        "options": {}
      },
      "id": "check-stats",
      "name": "Check Stats",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [850, 400]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.queueSize}}",
              "operation": "smaller",
              "value2": 10
            }
          ]
        }
      },
      "id": "check-queue",
      "name": "If Queue Not Full",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [650, 500]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "prepare-job",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare-job": {
      "main": [
        [
          {
            "node": "queue-job",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "schedule-trigger": {
      "main": [
        [
          {
            "node": "auto-select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "auto-select": {
      "main": [
        [
          {
            "node": "check-queue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-queue": {
      "main": [
        [
          {
            "node": "prepare-job",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "queue-job": {
      "main": [
        [
          {
            "node": "check-stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "id": "comfyui-ttrpg-automation"
}
